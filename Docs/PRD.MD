Product Requirements Document: Project "Locus"
Version: 1.4 (Final Specs - Simplified UX)
Type: Cross-platform application, especially for MacOS. Ensure great MacOS laptop user experience.
Core Concept: A local-first, AI-powered "Hermeneutic Engine" for deep reading.
Engineering Principle: Serverless, "Bring Your Own Key" (BYOK).
1. Executive Summary
   Problem: Traditional e-readers are passive. They lack the tools for "Exegesis"—the deep interpretation and annotation required for philosophy and complex literature.
   Solution: A "Digital Codex" that acts as a reading partner. It uses the user's own API Key (OpenAI/Anthropic/Gemini) to provide specialized interpretation through the persona of a "Passionate Professor," integrated with a robust, book-specific annotation system.
   Vibe: Calm, Intelligent, Digital Neo-Classic.
2. User Personas
   ●	The Serious Student: Reading Being and Time. Needs to unpack German roots (Dasein) and save those definitions to the specific page.
   ●	The Connector: Wants to see who the author is secretly quoting or attacking (Intertextuality).
   ●	The Purist: Wants to read clean text, but occasionally jot down a manual thought without AI interference.
3. Design System & UI
   Theme: "Digital Neo-Classic."
   ●	Typography:
   ○	Canon (Book): Crimson Pro, Literata, or EB Garamond (Serif).
   ○	Commentary (AI/Notes): Inter or Helvetica Now (Sans-Serif).
   ●	Palette:
   ○	Background: Warm Porcelain (#F9F7F1) or Stone (#F5F5F7).
   ○	Text: Deep Charcoal (#333333).
   ○	Accent: Muted Indigo (#4A5D88) for interactive elements.
   ●	Layout:
   ○	Asymmetric: Text body (65%) left; Margin (35%) right.
   ○	Sliding Animation: Sidebar slides in; text reflows to accommodate it.
4. Functional Requirements
   4.1. File Ingestion (Serverless)
   ●	Supported Formats: EPUB (Native), MOBI/AZW3 (Auto-convert locally).
   ●	Auto-Detection (The Handshake):
   ○	Trigger: First open.
   ○	Action: Send first ~500 tokens to AI (User's Key).
   ○	Prompt: "Identify Title, Author, and Translator. Return JSON."
   ○	Result: Save metadata locally.
   ○	Fallback: "Research Partner" mode if unrecognized.
   4.2. The "Action Menu" (Single-Stream)
   ●	Design Philosophy: "Uncluttered Focus." The floating menu should effectively be a "Lens Selector" only. Standard utilities are deemphasized.
   ●	Trigger: User highlights text.
   ●	Layout: A Single-Row Horizontal Ribbon.
   ○	Visuals: A sleek, capsule-style scrolling strip. High contrast background.
   ○	Content (The Chips):
1.	Note (Opens Sidebar in writing mode - Zero API Cost).
2.	Intertextuality (The Genealogy):
      Function: Reveal who the author is quoting, attacking, or referencing.
      Ex: "This line is a direct inversion of a verse from Matthew 5:3."
3.	Philology (The Roots):
      Function: Explain etymology and original language nuance (Greek/German/Latin).
      Ex: "Heidegger uses 'Dasein' here, not 'Existenz'..."
4.	History (The Context):
      Function: Political, temporal, and biographical context.
      Ex: "Kant is writing this while the French Revolution is happening next door..."
5.	Culture (The Encyclopedia):
      Function: Explain mythological figures, art references, or geography.
      Ex: "Who is 'Moloch'?"
6.	Logic (The Argument):
      Function: Reconstruct the formal logical premises and conclusion.
      Ex: "Premise 1: x... Premise 2: y... Conclusion: z."
7.	Syntax (The Deconstruction):
      Function: Highlight the core Subject-Verb-Object in dense prose, fading out subordinate clauses.
      Ex: Helping a user parse a long sentence by Henry James.
8.	Reception (The Aftermath):
      Function: How was this specific line interpreted (or misused) by later generations?

●	Interaction: Tapping any "Lens" immediately triggers the slide-in animation and starts the specific AI Persona mode. Tapping "Note" just opens the sidebar with the keyboard active.
4.3. The AI Interaction (Unified Sidebar)
●	Concept: The Sidebar is a "Unified Workspace" for thinking. It is not just an AI output zone; it is the user's marginalia space.
●	Flow: Highlight -> Select Lens -> Sidebar Opens.
●	The Input Field:
○	At the bottom of the sidebar, there is always a "Write / Reply" input field.
○	Context Aware: If the user types here after an AI explanation, it acts as a Chat Reply. If the user opens via "Note," it acts as a Manual Note.
●	Persistence:
○	"Save to Margin" Button: A clear action to finalize the current chat/thought into a permanent anchor.
4.4. The Note System (Book-Specific)
●	Scope: Notes are strictly scoped to the current book. No global dashboard.
●	Types of Notes:
○	Manual: Written entirely by the user.
○	AI-Derived: Generated by AI, curated/saved by the user.
●	The "Book Index" View (Overview):
○	Access: A button inside the Reader UI (e.g., alongside Table of Contents).
○	Interface: A list of all annotations made in this specific file.
○	Sorting: Chronological (by page number).
○	Visuals: "Index Card" style showing the$$Highlighted Text$$$$User/AI Note$$
.
○	Export: Option to export all notes for this book to Markdown/JSON.
4.5. The "Lantern" (Discovery)
●	UI: Subtle icon in bottom corner.
●	Function: AI scans the visible page for hidden depth/context.
●	Result: Temporary "Smart Underlines" (Blue=History, Red=Philology). User taps to investigate.
5. The AI Persona ("The Passionate Professor")
   System Prompt Guidelines:
   ●	Tone: "Intellectually enthusiastic but epistemically neutral."
   ●	Pronouns: Use "We" (shared investigation).
   ●	Perspective: "Steel-man" arguments. Focus on the stakes of the ideas.
   ●	Translator Awareness: Critique the specific translation choices if known (e.g., "Kaufmann captures the fury here, whereas Hollingdale is too dry").
6. Technical Architecture (Local-First)
   6.1. Data Structure (The Sidecar)
   ●	File: Book_Title_Meta.json stored locally next to the EPUB.
   ●	Schema:
   {
   "book_id": "hash_123",
   "metadata": { "title": "The Republic", "translator": "Bloom" },
   "annotations": [
   {
   "cfi_range": "epubcfi(/6/14[chap1]...)",
   "highlight_text": "The cave...",
   "note_content": "Plato's allegory of education.",
   "type": "user_manual",
   "timestamp": 1715000
   }
   ]
   }


6.2. AI Backend (BYOK)
●	API Key: User inputs key (OpenAI/Anthropic/Gemini). Stored in Secure Enclave.
●	Privacy: No data sent to developer servers. Direct connection: Device <-> AI Provider.
7. MVP Success Metrics
   ●	Stability: EPUB rendering and resizing works without losing note anchors.
   ●	Latency: AI "Lenses" trigger within 2 seconds.
   ●	Utility: User "Saves" notes in >50% of reading sessions.
